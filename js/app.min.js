"use strict";var webqGalleryPlaylistId="PLpEUxmlKGIdkkbHbf9aiuhj7_fJ7XIMMt",webqMapVidData=function(e){var t={},a=e.match(/[^\r\n]+/g);return t.phyName=a[0],t.phySpecialties=a[1],t.phyURL=a[2],t.phyPhoto=a[3],t.question=a[4],t},videoGalleryWidget=angular.module("videoGalleryWidget",["ngRoute","dibari.angular-ellipsis"]);videoGalleryWidget.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://web-q-hospital.prod.ehc.com/**"])}]),videoGalleryWidget.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/videos.html",controller:"galleryCtrl",controllerAs:"gallery",resolve:{youtubeData:["youtubeService",function(e){return e.getPlaylist()}]}}).when("/v/:videoId",{templateUrl:"partials/videos.html",controller:"galleryCtrl",controllerAs:"gallery",resolve:{youtubeData:["youtubeService",function(e){return e.getPlaylist()}]}}).otherwise({redirectTo:"/"})}]),videoGalleryWidget.constant("YT_event",{STOP:0,PLAY:1,PAUSE:2,STATUS_CHANGE:3}),videoGalleryWidget.service("youtubeService",["$http","$q",function(e,t){function a(a){var o="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=6&playlistId="+webqGalleryPlaylistId+"&key=AIzaSyAIaRim_M52Tpr8fiGEItGTQ9Xw5rYUjjI";a&&(o=o+"&pageToken="+a);var i=t.defer();return e({method:"GET",url:o}).then(function(e){var t=e.data;angular.forEach(e.data.items,function(e,t){e.webq=webqMapVidData(e.snippet.description)}),i.resolve(t)},function(e){i.reject(e)}),i.promise}function o(a){var o="https://www.googleapis.com/youtube/v3/videos?part=snippet&maxResults=6&id="+a+"&key=AIzaSyAIaRim_M52Tpr8fiGEItGTQ9Xw5rYUjjI",i=t.defer();return e({method:"GET",url:o}).then(function(e){var t=e.data.items[0];t.webq=webqMapVidData(t.snippet.description),i.resolve(t)},function(e){i.reject(e)}),i.promise}return{getPlaylist:a,getVideo:o}}]),videoGalleryWidget.controller("galleryCtrl",["$routeParams","$location","$anchorScroll","$scope","$timeout","youtubeData","youtubeService","YT_event",function(e,t,a,o,i,r,n,l){var d=this;d.playerStatus="NOTPLAYING",e.videoId?(d.videoId=e.videoId,n.getVideo(d.videoId).then(function(e){d.current=e.webq})):(d.videoId=r.items[0].snippet.resourceId.videoId,d.current=r.items[0].webq),d.youtubeData=r,o.$on(l.STATUS_CHANGE,function(e,t){d.playerStatus=t}),o.YT_event=l,o.youtubeControl=function(e){o.$broadcast(e)},o.playNewVideo=function(e,r){d.current=r,d.videoId=e;var n=t.hash();t.hash("webq-vg-top"),a(),t.hash(n),t.search("webq-vg-top",null),i(function(){o.$broadcast(l.PLAY)},0)},d.next=function(){n.getPlaylist(d.youtubeData.nextPageToken).then(function(e){d.youtubeData=e})},d.prev=function(){n.getPlaylist(d.youtubeData.prevPageToken).then(function(e){d.youtubeData=e})}}]),videoGalleryWidget.directive("youtube",["$window","YT_event",function(e,t){return{restrict:"E",scope:{height:"@",width:"@",videoid:"@"},template:"<div></div>",link:function(a,o,i,r){var n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(n,l);var d;e.onYouTubeIframeAPIReady=function(){d=new YT.Player(o.children()[0],{playerVars:{controls:1,color:"white",autoplay:0,disablekb:1,enablejsapi:1,html5:1,iv_load_policy:3,modestbranding:0,showinfo:0,rel:0},height:a.height,width:a.width,videoId:a.videoid,events:{onStateChange:function(e){var o={event:t.STATUS_CHANGE,data:""};switch(e.data){case YT.PlayerState.PLAYING:o.data="PLAYING";break;case YT.PlayerState.ENDED:o.data="ENDED",d.seekTo(0),d.stopVideo();break;case YT.PlayerState.CUED:o.data="NOTPLAYING";break;case YT.PlayerState.PAUSED:o.data="PAUSED"}a.$apply(function(){a.$emit(o.event,o.data)})}}})},a.$watch("height + width",function(e,t){e!=t&&d.setSize(a.width,a.height)}),a.$watch("videoid",function(e,t){e!=t&&d.cueVideoById(a.videoid)}),a.$on(t.STOP,function(){d.seekTo(0),d.stopVideo()}),a.$on(t.PLAY,function(){d.playVideo()}),a.$on(t.PAUSE,function(){d.pauseVideo()})}}}]),angular.element(document).ready(function(){angular.bootstrap(document,["videoGalleryWidget"])});