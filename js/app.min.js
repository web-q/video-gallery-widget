"use strict";var webqMapVidData=function(e){var t={},o=e.match(/[^\r\n]+/g);return t.phyName=o[0],t.phySpecialties=o[1],t.phyURL=o[2],t.phyPhoto=o[3],t.question=o[4],t},videoGalleryWidget=angular.module("videoGalleryWidget",["ngRoute","dibari.angular-ellipsis"]);videoGalleryWidget.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://web-q-hospital.prod.ehc.com/**"])}]),videoGalleryWidget.config(["$routeProvider",function(e){e.when("/",{templateUrl:"//web-q-hospital.prod.ehc.com/global/hut/widgets/video-gallery-widget/v1.0/partials/videos.html",controller:"galleryCtrl",controllerAs:"gallery",resolve:{youtubeData:["youtubeService",function(e){return e.getPlaylist()}]}}).when("/v/:videoId",{templateUrl:"//web-q-hospital.prod.ehc.com/global/hut/widgets/video-gallery-widget/v1.0/partials/videos.html",controller:"galleryCtrl",controllerAs:"gallery",resolve:{youtubeData:["youtubeService",function(e){return e.getPlaylist()}]}}).otherwise({redirectTo:"/"})}]),videoGalleryWidget.constant("YT_event",{STOP:0,PLAY:1,PAUSE:2,STATUS_CHANGE:3}),videoGalleryWidget.service("youtubeService",["$http","$q",function(e,t){function o(o){var a="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=6&playlistId="+webqGalleryPlaylistId+"&key=AIzaSyAIaRim_M52Tpr8fiGEItGTQ9Xw5rYUjjI";o&&(a=a+"&pageToken="+o);var i=t.defer();return e({method:"GET",url:a}).then(function(e){var t=e.data;angular.forEach(e.data.items,function(e,t){e.webq=webqMapVidData(e.snippet.description)}),i.resolve(t)},function(e){i.reject(e)}),i.promise}function a(o){var a="https://www.googleapis.com/youtube/v3/videos?part=snippet&maxResults=6&id="+o+"&key=AIzaSyAIaRim_M52Tpr8fiGEItGTQ9Xw5rYUjjI",i=t.defer();return e({method:"GET",url:a}).then(function(e){var t=e.data.items[0];t.webq=webqMapVidData(t.snippet.description),i.resolve(t)},function(e){i.reject(e)}),i.promise}return{getPlaylist:o,getVideo:a}}]),videoGalleryWidget.controller("galleryCtrl",["$routeParams","$location","$anchorScroll","$scope","$timeout","youtubeData","youtubeService","YT_event",function(e,t,o,a,i,r,n,l){var d=this;d.playerStatus="NOTPLAYING",e.videoId?(d.videoId=e.videoId,n.getVideo(d.videoId).then(function(e){d.current=e.webq})):(d.videoId=r.items[0].snippet.resourceId.videoId,d.current=r.items[0].webq),d.youtubeData=r,a.$on(l.STATUS_CHANGE,function(e,t){d.playerStatus=t}),a.YT_event=l,a.youtubeControl=function(e){a.$broadcast(e)},a.playNewVideo=function(e,r){d.current=r,d.videoId=e;var n=t.hash();t.hash("webq-vg-top"),o(),t.hash(n),t.search("webq-vg-top",null),i(function(){a.$broadcast(l.PLAY)},0)},d.next=function(){n.getPlaylist(d.youtubeData.nextPageToken).then(function(e){d.youtubeData=e})},d.prev=function(){n.getPlaylist(d.youtubeData.prevPageToken).then(function(e){d.youtubeData=e})}}]),videoGalleryWidget.directive("youtube",["$window","YT_event",function(e,t){return{restrict:"E",scope:{height:"@",width:"@",videoid:"@"},template:"<div></div>",link:function(o,a,i,r){var n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(n,l);var d;e.onYouTubeIframeAPIReady=function(){d=new YT.Player(a.children()[0],{playerVars:{controls:1,color:"white",autoplay:0,disablekb:1,enablejsapi:1,html5:1,iv_load_policy:3,modestbranding:0,showinfo:0,rel:0},height:o.height,width:o.width,videoId:o.videoid,events:{onStateChange:function(e){var a={event:t.STATUS_CHANGE,data:""};switch(e.data){case YT.PlayerState.PLAYING:a.data="PLAYING";break;case YT.PlayerState.ENDED:a.data="ENDED",d.seekTo(0),d.stopVideo();break;case YT.PlayerState.CUED:a.data="NOTPLAYING";break;case YT.PlayerState.PAUSED:a.data="PAUSED"}o.$apply(function(){o.$emit(a.event,a.data)})}}})},o.$watch("height + width",function(e,t){e!=t&&d.setSize(o.width,o.height)}),o.$watch("videoid",function(e,t){e!=t&&d.cueVideoById(o.videoid)}),o.$on(t.STOP,function(){d.seekTo(0),d.stopVideo()}),o.$on(t.PLAY,function(){d.playVideo()}),o.$on(t.PAUSE,function(){d.pauseVideo()})}}}]),angular.element(document).ready(function(){angular.bootstrap(document,["videoGalleryWidget"])});